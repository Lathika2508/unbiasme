<!DOCTYPE html>
<html>
<head>
  <title>Quiz</title>
  <link rel="stylesheet" href="/quiz.css">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
</head>
<body>

<div id="quiz-container" class="d-flex justify-content-center align-items-center text-center min-vh-100">
    <div class="quiz-box w-100">
      <h2 id="question-title">Your Question Appears Here</h2>
      <form id="quiz-form">
        <label class="radio-button">
          <input type="radio" name="option" value="A" onchange="toggleCustom(false)">
          <span id="labelA">Option A</span>
          <span class="radio-button__custom"></span>
        </label>

        <label class="radio-button">
          <input type="radio" name="option" value="B" onchange="toggleCustom(false)">
          <span id="labelB">Option B</span>
          <span class="radio-button__custom"></span>
        </label>

        <label class="radio-button">
          <input type="radio" name="option" value="C" onchange="toggleCustom(false)">
          <span id="labelC">Option C</span>
          <span class="radio-button__custom"></span>
        </label>

        <label class="radio-button">
          <input type="radio" name="option" value="D" onchange="toggleCustom(false)">
          <span id="labelD">Option D</span>
          <span class="radio-button__custom"></span>
        </label>

        <label class="radio-button">
          <input type="radio" name="option" value="E" onchange="toggleCustom(true)">
          <span>Other:</span>
          <span class="radio-button__custom"></span>
        </label>
        <div class="form-input">
          <input class="input" id="custom-answer" placeholder="Type your text" required="" type="text">
          <span class="input-border"></span>
        </div>
        <div class="mt-4 margin">
          <button type="button" onclick="submitAnswer()">Next</button>
        </div>
      </form>
    </div>
  </div>
<div id="feedback-screen"></div>

<div id="result" style="display: none;">
  <h2>Quiz Complete!</h2>
  <p>Your Score: <span id="score"></span>/10</p>
  <pre id="user-answers-output"></pre>
</div>


<div id="feedback-screen"></div>

<div id="result" style="display: none;">
  <h2>Quiz Complete!</h2>
  <p>Your Score: <span id="score"></span>/10</p>
  <pre id="user-answers-output"></pre>
</div>


  <script>
    function toggleCustom(show) {
      document.getElementById("custom-answer").style.display = show ? "block" : "none";
    }
    let questions = [];
    let currentQuestion = 0;
    let score = 0;
    const userAnswers = {};

    async function fetchQuestions() {
      const res = await fetch('/quiz/questions');
      questions = await res.json();
      loadQuestion();
    }

    function loadQuestion() {
      const q = questions[currentQuestion];
      document.getElementById("question-title").textContent = `Q${currentQuestion + 1}: ${q.question}`;
      document.getElementById("labelA").textContent = q.options.A;
      document.getElementById("labelB").textContent = q.options.B;
      document.getElementById("labelC").textContent = q.options.C;
      document.getElementById("labelD").textContent = q.options.D;

      document.querySelectorAll('input[name="option"]').forEach(el => el.checked = false);
      toggleCustom(false);
      document.getElementById("custom-answer").value = "";
    }

    function toggleCustom(show) {
      document.getElementById("custom-answer").style.display = show ? "inline-block" : "none";
    }

    function submitAnswer() {
      const selected = document.querySelector('input[name="option"]:checked');
      if (!selected) return alert("Please select an answer.");

      const answerKey = selected.value;
      const q = questions[currentQuestion];
      let answerText = "";

      if (answerKey === "E") {
        const customInput = document.getElementById("custom-answer").value.trim();
        if (!customInput) return alert("Please enter your custom answer.");
        answerText = customInput;
      } else {
        answerText = q.options[answerKey];
      }

      const feedback = q.feedback[answerKey] || "Thanks for your answer!";
      userAnswers[currentQuestion] = answerText;

      document.getElementById("feedback-screen").textContent = feedback;
      document.getElementById("feedback-screen").style.display = "flex";
      document.getElementById("quiz-container").style.display = "none";

      setTimeout(() => {
        document.getElementById("feedback-screen").style.display = "none";
        currentQuestion++;
        if (currentQuestion < questions.length) {
          document.getElementById("quiz-container").style.display = "block";
          loadQuestion();
        } else {
          showResult();
        }
      }, 10000); // seconds
    }

    function showResult() {
      document.getElementById("quiz-container").style.display = "none";
      document.getElementById("score").textContent = score;
      document.getElementById("result").style.display = "block";

      let output = "";
      questions.forEach((q, i) => {
        output += `Q${i + 1}: ${userAnswers[i] || "Not Answered"}\n`;
      });

      document.getElementById("user-answers-output").textContent = output;
    }
    fetchQuestions();
  </script>
</body>
</html>
